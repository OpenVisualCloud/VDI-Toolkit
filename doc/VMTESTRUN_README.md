# vmtestrun.py
## Description
parse the vm guest ip address list and connect to guest winappdriver to execute winapptest.py on remote guest

## Usage: vmtestrun.py
## Installation
python2.7 must be installed as prerequisition

###  1. PyQt Installation

#### 1.1 PyQT Windows Installation

x86 | x86_64
----|-------
[PyQt4](http://sourceforge.net/projects/pyqt/files/PyQt4/PyQt-4.11.3/PyQt4-4.11.3-gpl-Py2.7-Qt4.8.6-x32.exe) | [PyQt4](http://sourceforge.net/projects/pyqt/files/PyQt4/PyQt-4.11.3/PyQt4-4.11.3-gpl-Py2.7-Qt4.8.6-x64.exe/download)
[PyWin32](http://sourceforge.net/projects/pywin32/files/pywin32/Build%20218/pywin32-218.win32-py2.7.exe/download) | [PyWin32](http://sourceforge.net/projects/pywin32/files/pywin32/Build%20218/pywin32-218.win-amd64-py2.7.exe/download)

Finally Windows download VCForPython27.msi and install

#### 1.2 PyQT Linux installation
- Download get_pip.py from https://bootstrap.pypa.io/pip/2.7/get-pip.py, then

```
python2.7 get-pip.py
```
- Install related PIP packages
```
pip install Twisted==20.3.0
pip install pyOpenSSL==20.0.0
pip install qt4reactor==1.6
pip install service-identity==21.1.0
pip install rsa==4.5
pip install pyasn1==0.4.8
pip install attrs==20.3.0
pip install wheel==0.37.1
yum install python-qt4
```

### 2. Appium Installation:
```
pip install Appium-Python-Client==0.3

pip install Twisted==20.3.0
pip install pyOpenSSL==20.0.0
pip install qt4reactor==1.6
pip install service-identity==21.1.0
pip install rsa==4.5
pip install pyasn1==0.4.8
pip install attrs==20.3.0
pip install wheel==0.37.1
```


### 3. rdpy Installation:

Get and install rdpy from https://github.com/citronneur/rdpy:
```
git clone https://github.com/citronneur/rdpy.git rdpy
Apply the mouse move patch to the rdpy:
git am 0001-Added-auto-mouse-move-to-avoid-stop-connection.patch
```
```
python rdpy/setup.py install
```
```
- Copy the generated vm_ip.txt to the same directory as vmtestrun.py, and also the winapptest.py, put the test app xml in the same directory,
- run vmtestrun.py it will parse the vm_ip.txt, and connect the ip address in the txt and run the winapptest with the xml files in the same directory
- vm_ip.txt will be generated by findip.txt after you create the VMs
```

### Test VM

- for linux, Xvfb needs to be installed and configured first
```
yum install Xvfb
nohup Xvfb -ac :7 -screen 0 1280x1024x8 > /dev/null 2>&1 &
export DISPLAY=:7
```
- Test with VNC connection
```
python2.7 vmtestrun.py -p 1234 -c VNC -f vm_ip.txt
```

- Test vm with RDP connection
```
python2.7 vmtestrun.py -u administrator -p 1234 -c RDP -f vm_ip.txt
```